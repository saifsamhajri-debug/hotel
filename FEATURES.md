# الميزات الجديدة المضافة

## 1. اسم الفندق والشعار في القائمة الرئيسية

تم إضافة إمكانية تخصيص اسم الفندق والشعار:

- **اسم الفندق**: يظهر في القائمة الرئيسية، عنوان الصفحة، والفواتير
- **الشعار**: يمكن إضافة شعار الفندق في القائمة الرئيسية

### كيفية التخصيص:

1. انسخ ملف `.env.example` إلى `.env`
2. قم بتعديل القيم التالية:
   ```
   HOTEL_NAME=اسم فندقك هنا
   HOTEL_LOGO=img/logo.png
   ```
3. ضع ملف الشعار في مجلد `hotel/static/img/`

---

## 2. تسجيل أوقات الدخول والخروج

تم إضافة تسجيل تلقائي لأوقات الدخول والخروج الفعلية:

- **وقت تسجيل الدخول**: يتم تسجيله تلقائياً عند الضغط على زر "تسجيل الدخول"
- **وقت تسجيل الخروج**: يتم تسجيله تلقائياً عند الضغط على زر "تسجيل الخروج"
- **المصدر**: يتم أخذ الوقت من ساعة نظام Windows
- **العرض**: تظهر الأوقات في صفحة تفاصيل الحجز والفاتورة

### الحقول المضافة:
- `actual_check_in_time`: وقت تسجيل الدخول الفعلي (DateTime)
- `actual_check_out_time`: وقت تسجيل الخروج الفعلي (DateTime)

---

## 3. نظام الخدمات الإضافية

تم إضافة نظام كامل لإدارة الخدمات الإضافية للحجوزات:

### الخدمات المتاحة:
1. **وجبة إفطار** - 15 ريال
2. **وجبة غداء** - 25 ريال
3. **وجبة عشاء** - 20 ريال
4. **خدمة غسيل الملابس** - 10 ريال
5. **خدمة الغرف** - 5 ريال
6. **ميني بار** - 30 ريال
7. **خدمة السبا** - 50 ريال
8. **موقف سيارات** - 5 ريال
9. **نقل من/إلى المطار** - 40 ريال

### كيفية الاستخدام:
1. افتح صفحة تفاصيل الحجز
2. اضغط على زر "إضافة خدمة"
3. اختر نوع الخدمة والكمية
4. أضف ملاحظات إن وجدت
5. اضغط "إضافة الخدمة"

### الميزات:
- حساب تلقائي للسعر الإجمالي
- إمكانية إضافة عدة خدمات لنفس الحجز
- إمكانية حذف الخدمات
- عرض جميع الخدمات في صفحة تفاصيل الحجز
- تضمين الخدمات في الفاتورة

---

## 4. نظام الفواتير

تم إضافة نظام فواتير متكامل:

### محتويات الفاتورة:
1. **معلومات الفندق**: اسم الفندق والشعار
2. **معلومات الفاتورة**: رقم الفاتورة، تاريخ الإصدار، حالة الحجز
3. **معلومات العميل**: الاسم، رقم الهوية، الهاتف، البريد الإلكتروني
4. **معلومات الحجز**: رقم الحجز، رقم الغرفة، تواريخ الوصول والمغادرة
5. **أوقات الدخول والخروج الفعلية**: إن وجدت
6. **تفاصيل الإقامة**: عدد الليالي، السعر لليلة، الإجمالي
7. **الخدمات الإضافية**: قائمة بجميع الخدمات مع الأسعار
8. **المبالغ المستحقة**: 
   - إجمالي الإقامة
   - إجمالي الخدمات
   - **المبلغ الإجمالي النهائي**

### كيفية الوصول للفاتورة:
1. افتح صفحة تفاصيل الحجز
2. اضغط على زر "عرض الفاتورة" (يظهر فقط للحجوزات التي تم تسجيل الدخول أو الخروج فيها)

---

## 5. طباعة الفاتورة

تم إضافة خيارين للطباعة:

### 1. الطباعة المباشرة:
- اضغط على زر "طباعة" في صفحة الفاتورة
- سيتم فتح نافذة الطباعة الخاصة بالمتصفح
- اختر الطابعة واضغط "طباعة"

### 2. تحميل PDF:
- اضغط على زر "تحميل PDF" في صفحة الفاتورة
- سيتم تحميل الفاتورة كملف PDF
- يمكنك حفظ الملف أو طباعته لاحقاً

### المكتبات المستخدمة:
- **WeasyPrint**: لتوليد PDF من HTML (الخيار الأول)
- **ReportLab**: كخيار بديل إذا لم يتوفر WeasyPrint

---

## 6. تحديثات قاعدة البيانات

تم إضافة الجداول والحقول التالية:

### جدول Booking (محدث):
- `actual_check_in_time`: DateTime (nullable)
- `actual_check_out_time`: DateTime (nullable)

### جدول Service (جديد):
- `id`: Integer (Primary Key)
- `booking_id`: Integer (Foreign Key)
- `service_type`: String(50)
- `service_name`: String(100)
- `quantity`: Integer
- `price`: Float
- `total_price`: Float
- `created_at`: DateTime
- `notes`: Text

### كيفية تحديث قاعدة البيانات:
```bash
python update_db.py
```

---

## 7. واجهة المستخدم المحسنة

تم تحسين واجهة المستخدم في:

1. **صفحة تفاصيل الحجز**:
   - عرض أوقات الدخول والخروج الفعلية
   - قسم الخدمات الإضافية مع جدول تفصيلي
   - زر إضافة خدمة
   - زر عرض الفاتورة

2. **صفحة الفاتورة**:
   - تصميم احترافي للطباعة
   - عرض جميع التفاصيل بشكل منظم
   - أزرار الطباعة وتحميل PDF

3. **القائمة الرئيسية**:
   - عرض اسم الفندق والشعار
   - تصميم محسن للعلامة التجارية

---

## ملاحظات مهمة

1. **الصلاحيات**:
   - فقط المسؤولين (Admin) يمكنهم إضافة وحذف الخدمات
   - جميع المستخدمين يمكنهم عرض الفواتير الخاصة بحجوزاتهم

2. **الأوقات**:
   - يتم تسجيل الأوقات بتوقيت النظام المحلي
   - الأوقات تظهر بصيغة: YYYY-MM-DD HH:MM:SS

3. **الفواتير**:
   - الفواتير متاحة فقط للحجوزات التي تم تسجيل الدخول أو الخروج فيها
   - يمكن طباعة الفاتورة في أي وقت بعد تسجيل الدخول

4. **الخدمات**:
   - يمكن إضافة الخدمات فقط للحجوزات المؤكدة أو التي تم تسجيل الدخول فيها
   - الأسعار محددة مسبقاً في ملف `models/service.py`
   - يمكن تعديل الأسعار من الكود

---

## التحديثات المستقبلية المقترحة

1. إمكانية تعديل أسعار الخدمات من لوحة التحكم
2. إضافة خدمات مخصصة
3. تقارير مالية شاملة
4. إرسال الفاتورة بالبريد الإلكتروني
5. دعم عملات متعددة
6. نظام الخصومات والعروض

